local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

-- Configurazione tempo stimato per wave 10 (in secondi)
local tempoStimatoPerWave10 = 120 -- puoi modificare in base alla tua esperienza

-- Stato interno
local autoRestartEnabled = false

-- Funzioni per avviare e riavviare il castello
local function startInfiniteCastle()
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local dataRemoteEvent = ReplicatedStorage:WaitForChild("BridgeNet2"):WaitForChild("dataRemoteEvent")

    local createArgs = {{ { Event = "InfiniteCastleAction", Action = "Create" }, "\r" }}
    dataRemoteEvent:FireServer(unpack(createArgs))
    wait(2)

    local startArgs = {{ { Dungeon = 3604563306, Event = "InfiniteCastleAction", Action = "Start" }, "\r" }}
    dataRemoteEvent:FireServer(unpack(startArgs))
    print("Castello avviato")
end

local function restartCastle()
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local dataRemoteEvent = ReplicatedStorage:WaitForChild("BridgeNet2"):WaitForChild("dataRemoteEvent")

    local leaveArgs = {{ { Event = "InfiniteCastleAction", Action = "Leave" }, "\r" }}
    dataRemoteEvent:FireServer(unpack(leaveArgs))
    print("Castello riavviato")
end

-- UI
local Window = Rayfield:CreateWindow({
    Name = "InfiniteCastle Hub",
    LoadingTitle = "InfiniteCastle Loader",
    LoadingSubtitle = "by xnxsmoke",
    ConfigurationSaving = {
        Enabled = true,
        FileName = "InfiniteCastleHub"
    },
})

local MainTab = Window:CreateTab("Main", 4483362458)

local AutoRestartToggle = MainTab:CreateToggle({
    Name = "Auto-Restart basato sul tempo",
    CurrentValue = false,
    Flag = "AutoRestartTimeFlag",
    Callback = function(Value)
        autoRestartEnabled = Value
        if autoRestartEnabled then
            Rayfield:Notify({Title="Auto-Restart", Content="Auto-Restart attivato!", Duration=3})
            spawn(function()
                while autoRestartEnabled do
                    startInfiniteCastle()
                    wait(tempoStimatoPerWave10)
                    restartCastle()
                    wait(3) -- breve pausa
                end
            end)
        else
            Rayfield:Notify({Title="Auto-Restart", Content="Auto-Restart fermato!", Duration=3})
        end
    end,
})

local TimeSlider = MainTab:CreateSlider({
    Name = "Tempo stimato (sec)",
    Range = {10, 600},
    Increment = 5,
    CurrentValue = tempoStimatoPerWave10,
    Flag = "TempoStimatoFlag",
    Callback = function(Value)
        tempoStimatoPerWave10 = Value
    end,
})
